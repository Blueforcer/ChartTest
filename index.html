<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart.js Beispiel</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.1.1"></script>
    <script src="data.js"></script>
</head>
<body>

<canvas id="myChart"></canvas>

<script>
    function downsample(data, visibleTimeSpan) {
        const totalDataPoints = data.length;
        let interval = Math.ceil(totalDataPoints / visibleTimeSpan);

        let downsampledData = [];
        for (let i = 0; i < totalDataPoints; i += interval) {
            let avgY = 0;
            let count = 0;
            for (let j = i; j < i + interval && j < totalDataPoints; j++) {
                avgY += data[j].y;
                count++;
            }
            avgY /= count;
            downsampledData.push({ x: data[i].x, y: avgY });
        }

        return downsampledData;
    }

    const ctx = document.getElementById('myChart').getContext('2d');

    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            datasets: [{
                label: 'Chlor',
                data: chartData.chlorData,
                borderColor: 'blue',
                fill: false,
                yAxisID: 'y-chlor'
            }, {
                label: 'pH',
                data: chartData.pHData,
                borderColor: 'green',
                fill: false,
                yAxisID: 'y-ph'
            }, {
                label: 'Temperatur',
                data: chartData.tempData,
                borderColor: 'red',
                fill: false,
                yAxisID: 'y-temp'
            }, {
                label: 'Redox',
                data: chartData.redoxData,
                borderColor: 'purple',
                fill: false,
                yAxisID: 'y-redox'
            }]
        },
        options: {
            scales: {
                x: {
                    type: 'timeseries',
                    time: {
                        parser: 'HH:mm:ss',
                        unit: 'hour',
                        displayFormats: {
                            hour: 'HH:mm:ss'
                        }
                    }
                },
                'y-chlor': {
                    type: 'linear',
                    position: 'left'
                },
                'y-ph': {
                    type: 'linear',
                    position: 'right',
                    offset: true
                },
                'y-temp': {
                    type: 'linear',
                    position: 'left',
                    offset: true
                },
                'y-redox': {
                    type: 'linear',
                    position: 'right'
                }
            },
            plugins: {
                zoom: {
                    pan: {
                        enabled: true,
                        mode: 'x',
                        speed: 10
                    },
                    zoom: {
                        wheel: {
                            enabled: true
                        },
                        drag: {
                            enabled: true
                        },
                        pinch: {
                            enabled: true
                        },
                        mode: 'x',
                        speed: 0.1
                    }
                }
            }
        }
    });

    chart.canvas.addEventListener('mouseup', function() {
        const visibleTimeSpan = chart.scales.x.max - chart.scales.x.min;
        const downsampledChlorData = downsample(chartData.chlorData, visibleTimeSpan);
        const downsampledPHData = downsample(chartData.pHData, visibleTimeSpan);
        const downsampledTempData = downsample(chartData.tempData, visibleTimeSpan);
        const downsampledRedoxData = downsample(chartData.redoxData, visibleTimeSpan);

        // Update the chart data and re-render
        chart.data.datasets[0].data = downsampledChlorData;
        chart.data.datasets[1].data = downsampledPHData;
        chart.data.datasets[2].data = downsampledTempData;
        chart.data.datasets[3].data = downsampledRedoxData;
        chart.update();
    });

</script>

</body>
</html>
